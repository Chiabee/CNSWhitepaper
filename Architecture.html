<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Technical Architecture - Chia Name Service White Paper</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="Cover.html"><strong aria-hidden="true">1.</strong> Cover</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="Introduction.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="Design.html"><strong aria-hidden="true">3.</strong> Design</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Lifecycle.html"><strong aria-hidden="true">3.1.</strong> Lifecycle</a></li><li class="chapter-item expanded "><a href="Policy.html"><strong aria-hidden="true">3.2.</strong> Policy</a></li></ol></li><li class="chapter-item expanded "><a href="Architecture.html" class="active"><strong aria-hidden="true">4.</strong> Technical Architecture</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Tech-Registration.html"><strong aria-hidden="true">4.1.</strong> Registration</a></li><li class="chapter-item expanded "><a href="Tech-Resolution.html"><strong aria-hidden="true">4.2.</strong> Resolution</a></li><li class="chapter-item expanded "><a href="Tech-Management.html"><strong aria-hidden="true">4.3.</strong> Management</a></li><li class="chapter-item expanded "><a href="Tech-Renewing.html"><strong aria-hidden="true">4.4.</strong> Renewing</a></li></ol></li><li class="chapter-item expanded "><a href="Security.html"><strong aria-hidden="true">5.</strong> Security</a></li><li class="chapter-item expanded "><a href="Governance.html"><strong aria-hidden="true">6.</strong> Governance</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Pricing.html"><strong aria-hidden="true">6.1.</strong> Pricing</a></li></ol></li><li class="chapter-item expanded "><a href="Beyond.html"><strong aria-hidden="true">7.</strong> Beyond</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="Faq.html"><strong aria-hidden="true">8.</strong> FAQ</a></li><li class="chapter-item expanded "><a href="About.html"><strong aria-hidden="true">9.</strong> About Us</a></li><li class="chapter-item expanded "><a href="BackCover.html"><strong aria-hidden="true">10.</strong> Back Cover</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Chia Name Service White Paper</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="technical-architecture"><a class="header" href="#technical-architecture">Technical Architecture</a></h1>
<p><img src="architecture.drawio.svg" alt="" /></p>
<ul>
<li>Full Node 全节点。用来实时获取Chia区块链上的数据。</li>
<li>Syncer 同步器。用来将全节点上的数据进行实时分析，并存入数据库备查。</li>
<li>Resolver 解析器。接受用户的域名解析请求，提供域名解析的结果。</li>
<li>Registrar 注册器。接受用户的注册请求，提供注册域名的NFT Offer。确定域名合法性的核心私钥存在此处，需高安全级别的保护。</li>
<li>Pawket 钱包。用户的区块链终端，可以进行去中心化的注册、解析、验证、更新和交易工作。</li>
<li>xch.cool 概况网页。通过该网站的个性化网页可以看到账户所拥有的NFT、CAT、XCH等资产信息。</li>
</ul>
<h2 id="钱包的功能"><a class="header" href="#钱包的功能">钱包的功能</a></h2>
<ul>
<li>注册：向注册器提交注册请求，如果该域名可用，则可以获得该域名的的NFT Offer，在钱包签名后直接向全节点发送交易完成注册。</li>
<li>解析：向解析器发起解析请求，提供域名获取对应的基本信息及NFT硬币信息。</li>
<li>验证：根据解析时获取的NFT硬币信息，通过全节点进行验证，验证1）该硬币为合法有效的域名NFT；2）与解析信息一致。</li>
<li>更新：构造更新NFT的交易信息，并提交至全节点上链。</li>
<li>交易：域名NFT全兼容正常的NFT，可以在所有能做NFT交易的市场上进行交易。</li>
</ul>
<h2 id="analytic-db"><a class="header" href="#analytic-db">Analytic DB</a></h2>
<p>::: mermaid
erDiagram
sync_coin_class {
bigint id PK
bytea coin_name
bytea puzzle
json parsed_puzzle
bytea solution
text mods
json analysis
}
sync_block {
bigint id PK
bool is_tx_block
bigint index
bigint weight
bigint iterations
bigint cost
bigint fee
bytea generator
bytea generator_ref_list
json block_info
bool tx_parsed
}
:::</p>
<p>::: mermaid
erDiagram
ext_singleton_record {
bigint id PK
bigint last_coin_class_id
bytea singleton_coin_name
int singleton_create_index
bytea bootstrap_coin_name
bytea creator_puzzle_hash
bytea creator_did
text type
}
ext_singleton_history {
bigint id PK
bigint coin_class_id
bytea singleton_coin_name
bytea this_coin_name
int this_coin_spent_index
bytea next_coin_name
bytea p2_owner
bytea did_owner
text type
}
:::</p>
<ul>
<li>type: &quot;CatV2&quot; | &quot;DidV1&quot; | &quot;NftV1&quot;</li>
</ul>
<h2 id="接口定义"><a class="header" href="#接口定义">接口定义</a></h2>
<h3 id="resolver"><a class="header" href="#resolver">Resolver</a></h3>
<ul>
<li>API: /resolve
<ul>
<li>Request:
<ul>
<li>queries: array
<ul>
<li>name: string 域名</li>
<li>type: string 解析类型，目前只支持<code>address</code></li>
</ul>
</li>
</ul>
</li>
<li>Response:
<ul>
<li>answers: array
<ul>
<li>name: string 解析的域名</li>
<li>type: string 解析类型</li>
<li>time_to_live: number 域名的更新周期</li>
<li>data: string 解析的内容，每种类型不一样，<code>address</code>对应绑定的xch地址</li>
<li>proof_coin_name: string 证明解析结果的硬币名称，即该NFT UTXO的父硬币</li>
<li>proof_coin_spent_index: number 包含证明解析结果硬币区块的高度</li>
<li>nft_coin_name: string 该域名的NFT名称</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="registrar"><a class="header" href="#registrar">Registrar</a></h3>
<ul>
<li>
<p>API: /register</p>
<ul>
<li>Request:
<ul>
<li>name: string 域名</li>
<li>address: string 绑定的xch地址</li>
<li>content_hash: string 验证内容的哈希【暂未开放】</li>
<li>text: string 任意文字内容【暂未开放】</li>
<li>dns: string DNS记录【暂未开放】</li>
<li>pk: string 公钥信息【暂未开放】</li>
</ul>
</li>
<li>Response:
<ul>
<li>name: string 域名</li>
<li>offer: string 注册域名的offer</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Register Offer Coins</p>
<ul>
<li>Bootstrap Coin -&gt; Launcher Coin</li>
<li>Launcher Coin (Singleton Coin) -&gt; NFT Hint Coin</li>
<li>NFT Hint Coin -&gt; Settlement Payment(NFT)</li>
<li>Settlement Payment(XCH) -&gt; Registrar Address</li>
</ul>
</li>
</ul>
<h2 id="name-registration"><a class="header" href="#name-registration">Name Registration</a></h2>
<p>As shown in the above figure, the name registration process involves 5 major steps:
Generate Logic Signature
The desired name is used as input to a standardized TEAL program and compiled, thereby creating a Logic Signature from the resulting TEAL program.
Pay Name Registration fee to the escrow address
The user must pay the name registration fee to the smart contract's escrow account. The total price is dependent on the length of the name and the desired number of years.
Fund Logic Signature
In order to be able to opt-in to Registry Smart Contract, the Logic Signature must possess 1.2 ALGOs. To meet this requirement, the Logic Signature account is first funded from the future name owner's wallet.
Opt-In to Registry Smart Contract
Once the Logic Signature representing the desired name is funded with the required minimum balance, an Opt-In transaction is processed to allow the Logic Signature account to be able to allocate local storage on the Name Registry smart contract. This transaction is signed and sent using the Logic Signature account.
Add Owner's Address
After opting-in to the Name Registry smart contract, the name owner adds their wallet address as the owner of the name by adding a local storage byte key-value. The name owner mentions Logic Signature account address in the accounts array of the transaction.</p>
<h2 id="name-lookup"><a class="header" href="#name-lookup">Name Lookup</a></h2>
<h2 id="name-transfer"><a class="header" href="#name-transfer">Name Transfer</a></h2>
<h2 id="name-binding"><a class="header" href="#name-binding">Name Binding</a></h2>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Policy.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="Tech-Registration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Policy.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="Tech-Registration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>


    </body>
</html>
